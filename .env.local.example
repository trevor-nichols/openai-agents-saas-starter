# Copy this file to .env.local and replace every secret before running in production.

# -----------------------------------------------------------------------------
# Core application (required everywhere)
# -----------------------------------------------------------------------------
ENVIRONMENT=development
DEBUG=true
PORT=8000
APP_PUBLIC_URL=http://localhost:3000
ALLOWED_HOSTS=localhost,localhost:8000,127.0.0.1,testserver,testclient
ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000

# -----------------------------------------------------------------------------
# Secrets (must be unique per environment before production)
# -----------------------------------------------------------------------------
SECRET_KEY=change-me
AUTH_PASSWORD_PEPPER=change-me-too
AUTH_REFRESH_TOKEN_PEPPER=change-me-again
AUTH_EMAIL_VERIFICATION_TOKEN_PEPPER=change-me-email
AUTH_PASSWORD_RESET_TOKEN_PEPPER=change-me-reset
# Required for encrypted session metadata in production
AUTH_SESSION_ENCRYPTION_KEY=
# Optional salt (defaults to SECRET_KEY when empty)
AUTH_SESSION_IP_HASH_SALT=

# -----------------------------------------------------------------------------
# Database / Redis (required)
# -----------------------------------------------------------------------------
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/saas_strarter_db
REDIS_URL=redis://localhost:6379/0
# Optional dedicated Redis pools (leave blank to reuse REDIS_URL locally)
RATE_LIMIT_REDIS_URL=
AUTH_CACHE_REDIS_URL=
SECURITY_TOKEN_REDIS_URL=
BILLING_EVENTS_REDIS_URL=
RATE_LIMIT_KEY_PREFIX=rate-limit
# Automatically run migrations on startup (dev convenience only)
AUTO_RUN_MIGRATIONS=false

# -----------------------------------------------------------------------------
# Rate limits (tune per-environment; defaults safe for dev)
# -----------------------------------------------------------------------------
CHAT_RATE_LIMIT_PER_MINUTE=60
CHAT_STREAM_RATE_LIMIT_PER_MINUTE=30
CHAT_STREAM_CONCURRENT_LIMIT=5
BILLING_STREAM_RATE_LIMIT_PER_MINUTE=20
BILLING_STREAM_CONCURRENT_LIMIT=3
PASSWORD_RESET_TOKEN_TTL_MINUTES=30
PASSWORD_RESET_EMAIL_RATE_LIMIT_PER_HOUR=5
PASSWORD_RESET_IP_RATE_LIMIT_PER_HOUR=20
EMAIL_VERIFICATION_TOKEN_TTL_MINUTES=60
EMAIL_VERIFICATION_EMAIL_RATE_LIMIT_PER_HOUR=3
EMAIL_VERIFICATION_IP_RATE_LIMIT_PER_HOUR=10

# -----------------------------------------------------------------------------
# Authentication policies (set before production)
# -----------------------------------------------------------------------------
REQUIRE_EMAIL_VERIFICATION=true
AUTH_PASSWORD_HISTORY_COUNT=5
AUTH_REFRESH_TOKEN_TTL_MINUTES=43200
AUTH_LOCKOUT_THRESHOLD=5
AUTH_LOCKOUT_WINDOW_MINUTES=60
AUTH_LOCKOUT_DURATION_MINUTES=60
AUTH_IP_LOCKOUT_THRESHOLD=50
AUTH_IP_LOCKOUT_WINDOW_MINUTES=10
AUTH_IP_LOCKOUT_DURATION_MINUTES=10
AUTH_JWKS_CACHE_SECONDS=300
AUTH_JWKS_MAX_AGE_SECONDS=300
AUTH_JWKS_ETAG_SALT=local-jwks-salt

# -----------------------------------------------------------------------------
# Tenant defaults & signup policies
# -----------------------------------------------------------------------------
TENANT_DEFAULT_SLUG=default
ALLOW_PUBLIC_SIGNUP=true
ALLOW_SIGNUP_TRIAL_OVERRIDE=false
SIGNUP_RATE_LIMIT_PER_HOUR=20
SIGNUP_DEFAULT_PLAN_CODE=starter
SIGNUP_DEFAULT_TRIAL_DAYS=14

# -----------------------------------------------------------------------------
# Billing (optional; required when ENABLE_BILLING=true)
# -----------------------------------------------------------------------------
ENABLE_BILLING=false
ENABLE_BILLING_STREAM=false
ENABLE_BILLING_RETRY_WORKER=true
ENABLE_BILLING_STREAM_REPLAY=true
BILLING_RETRY_DEPLOYMENT_MODE=inline
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PRODUCT_PRICE_MAP={"starter":"price_xxx"}

# -----------------------------------------------------------------------------
# AI Providers (set at least one before deploying agents)
# -----------------------------------------------------------------------------
OPENAI_API_KEY=
ANTHROPIC_API_KEY=
GEMINI_API_KEY=
XAI_API_KEY=
TAVILY_API_KEY=

# -----------------------------------------------------------------------------
# Email (Resend)
# -----------------------------------------------------------------------------
RESEND_EMAIL_ENABLED=false
RESEND_BASE_URL=https://api.resend.com
RESEND_API_KEY=
RESEND_DEFAULT_FROM=
RESEND_EMAIL_VERIFICATION_TEMPLATE_ID=
RESEND_PASSWORD_RESET_TEMPLATE_ID=

# -----------------------------------------------------------------------------
# Observability & GeoIP
# -----------------------------------------------------------------------------
LOGGING_SINK=stdout
LOGGING_FILE_PATH=var/log/api-service.log
LOGGING_FILE_MAX_MB=10
LOGGING_FILE_BACKUPS=5
LOGGING_DATADOG_API_KEY=
LOGGING_DATADOG_SITE=datadoghq.com
LOGGING_OTLP_ENDPOINT=
LOGGING_OTLP_HEADERS=
ENABLE_OTEL_COLLECTOR=false
OTEL_COLLECTOR_HTTP_PORT=4318
OTEL_COLLECTOR_GRPC_PORT=4317
OTEL_COLLECTOR_DIAG_PORT=13133
OTEL_MEMORY_LIMIT_MIB=512
OTEL_COLLECTOR_LOG_LEVEL=debug
OTEL_DEBUG_VERBOSITY=detailed
OTEL_EXPORTER_SENTRY_ENDPOINT=
OTEL_EXPORTER_SENTRY_AUTH_HEADER=
OTEL_EXPORTER_SENTRY_HEADERS=
OTEL_EXPORTER_DATADOG_API_KEY=
OTEL_EXPORTER_DATADOG_SITE=datadoghq.com
GEOIP_PROVIDER=none
GEOIP_MAXMIND_LICENSE_KEY=
GEOIP_IP2LOCATION_API_KEY=
ENABLE_FRONTEND_LOG_INGEST=false

# -----------------------------------------------------------------------------
# Frontend logging defaults
# -----------------------------------------------------------------------------
NEXT_PUBLIC_LOG_LEVEL=info
NEXT_PUBLIC_LOG_SINK=console

# -----------------------------------------------------------------------------
# Vault Transit (CLI forces true for staging/production deployments)
# -----------------------------------------------------------------------------
# Keep false for local dev. Non-local environments will refuse to start without
# VAULT_VERIFY_ENABLED=true and the fields below populated.
VAULT_VERIFY_ENABLED=false
VAULT_ADDR=
VAULT_TOKEN=
VAULT_TRANSIT_KEY=auth-service
