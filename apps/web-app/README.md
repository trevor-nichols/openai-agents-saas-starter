# Web App (Next.js 16)

Customer-facing UI for the OpenAI Agents SaaS starter. This is a Next.js 16 App Router project with a BFF layer (`app/api`) that proxies backend calls and attaches auth from cookies. UI is organized by feature modules and backed by a generated HeyAPI client.

## What this app includes
- Marketing site + authentication flows (App Router route groups).
- Authenticated application shell with workspace pages for chat, agents, workflows, billing, ops, and settings.
- BFF API routes under `app/api/v1/*` that proxy to FastAPI and enforce auth on the server.
- Generated OpenAPI client in `lib/api/client/` plus typed services + TanStack Query hooks.
- Streaming adapters for the public SSE contract (`public_sse_v1`) used by chat and workflows.
- Storybook setup with mocked queries for UI development.
- Playwright e2e tests and Vitest unit/integration tests.

## Architecture overview

```
apps/web-app/
├── app/                # App Router pages + API routes (BFF)
├── features/           # Feature modules (domain-focused UI)
├── components/         # UI primitives (shadcn) + shared UI
├── lib/                # API client, queries, server utilities, streaming helpers
├── hooks/              # Shared React hooks
├── types/              # Shared type definitions
├── tests/              # Playwright e2e suite
├── .storybook/         # Storybook config + mocks
└── seeds/              # Test seeds (Playwright)
```

Key rules (enforced in docs):
- Browser code never calls the FastAPI backend directly—use `/app/api` proxy routes.
- Data access flows **SDK → `lib/server/services` → server actions/API routes → `lib/api` fetchers → `lib/queries` hooks** (see `docs/frontend/data-access.md`).
- Use Shadcn components from `components/ui/` only. If missing, add via the shadcn workflow.

## Prerequisites
- Node.js 22+
- pnpm 10+ (the repo pins `pnpm@10.15.0`)

## Install & dev

```bash
cd apps/web-app
pnpm install
pnpm dev
```

The app runs at `http://localhost:3000`.

## Environment & configuration
- `.env.local` is generated by the Starter Console wizard; `.env.example` is the reference template.
- `API_BASE_URL` points the BFF to FastAPI (default `http://localhost:8000`).
- `APP_PUBLIC_URL` is the canonical public site URL used for metadata and links.
- Billing UI/routes follow backend feature flags from `/api/v1/features` (driven by `ENABLE_BILLING` in the API service).
- `NEXT_PUBLIC_AGENT_API_MOCK=true` enables mock data flows for local development.
- `LOG_ROOT` controls where Next.js dev logs are written (defaults to `var/log/current/frontend`).
- See `docs/frontend/data-access.md` and `docs/frontend/ui/components.md` for conventions.

## OpenAPI client generation
This app uses `@hey-api/openapi-ts` and outputs to `lib/api/client/`.

```bash
# Export OpenAPI artifacts (billing + fixtures)
just openapi-export

# Generate from the repo-level OpenAPI artifact
pnpm generate

# Generate the fixture-only SDK (outputs to lib/api/fixtures-client)
pnpm generate:fixtures
```

Never hand-edit generated files.

## Feature modules (high level)
- `features/chat` — primary chat workspace, streaming adapters, tool timelines.
- `features/agents` — agent catalog, tool surfaces, container bindings.
- `features/workflows` — workflow list, run view, streaming visualizations.
- `features/billing` — plans, events ledger, usage tables (gated by billing flag).
- `features/storage` — storage objects + vector store management.
- `features/account`, `features/settings`, `features/status-ops`, `features/marketing`.

## BFF API routes
All routes under `app/api/v1/*` proxy to the backend and attach auth cookies on the server. This keeps API keys and session tokens out of the browser and centralizes error handling.

## Storybook
Storybook lives in `.storybook/` and uses query mocks under `.storybook/mocks`.

```bash
cd apps/web-app
pnpm storybook
```

Story coverage includes `components/ui`, `components/shell`, and `features/*` with fixture data. Build a static bundle with `pnpm storybook:build`.

## Tests

```bash
cd apps/web-app
pnpm lint
pnpm type-check
pnpm validate       # lint + typecheck + test placement
pnpm test          # Vitest
pnpm test:e2e      # Playwright (real + mock projects)
```

Seed Playwright fixtures with `pnpm test:seed` (writes `tests/.fixtures.json` from `seeds/playwright.yaml`).

## Logs
Dev output is tee'd to `var/log/current/frontend/all.log` and `var/log/current/frontend/error.log` when running via `pnpm dev`.

## Related docs
- `docs/frontend/data-access.md`
- `docs/frontend/ui/components.md`
- `docs/frontend/features/*`
- `docs/frontend/next-16/*`
- `docs/ops/container-deployments.md`
- `apps/web-app/tests/README.md`
